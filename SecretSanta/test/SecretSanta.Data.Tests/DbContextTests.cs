using Microsoft.VisualStudio.TestTools.UnitTesting;
using System.Linq;
using System;
using System.Threading.Tasks;

namespace SecretSanta.Data.Tests
{
    [TestClass]
    public class DbContextTests
    {
        [TestMethod]
        public void AddGift()
        {
            DbContext dbContext = new DbContext();
            int beforeCount = dbContext.Gifts.Count();
            dbContext.Gifts.Add(new Gift(){Id=42, Title="Colgate"});
            dbContext.SaveChanges();

            Assert.AreEqual<int>(beforeCount+1, dbContext.Gifts.Count());
        }

        [TestMethod]
        async public Task Add_NewGift_Success()//cal:changed to this since were using SaveChangesAsync() over SaveChanges()
        {
            using DbContext dbContext = new DbContext();//cal: we using "using" here so it cleans up after the method.
            {
                int beforeCount = dbContext.Gifts.Count();
                //dbContext.Gifts.Add(new Gift(){Id=42, Title="Colgate"});//cal: we removed id since if we did, a new one would be autogenerated.
                //dbContext.Gifts.Add(new Gift(){Title="Colgate" + Guid.NewGuid().ToString()});
                Gift @gift = new Gift(){Title = "Colgate" +Guid.NewGuid().ToString()};
                int id = @gift.Id;
                dbContext.Gifts.Add(@gift);

                Assert.AreEqual<int>(0, @gift.Id);//cal: no db interraction yet till SaveChanges.
                //dbContext.SaveChanges();
                await dbContext.SaveChangesAsync();

                
                Assert.AreEqual<int>(beforeCount+1, dbContext.Gifts.Count());
            }
        }
    }
}
